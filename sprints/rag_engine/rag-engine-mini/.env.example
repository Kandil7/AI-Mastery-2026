# =============================================================================
# RAG Engine Mini - Environment Configuration
# =============================================================================
# Copy this file to .env and customize for your environment
# نسخ هذا الملف إلى .env وتخصيصه لبيئتك
# =============================================================================

# =============================================================================
# Application Settings / إعدادات التطبيق
# =============================================================================
APP_NAME=rag-engine-mini
ENV=dev                                    # dev | staging | prod
DEBUG=true
LOG_LEVEL=DEBUG                            # DEBUG | INFO | WARNING | ERROR

# =============================================================================
# Security / الأمان
# =============================================================================
API_KEY_HEADER=X-API-KEY
# Note: API keys are stored in the database (users table)

# =============================================================================
# Database (PostgreSQL) / قاعدة البيانات
# =============================================================================
DATABASE_URL=postgresql+psycopg://postgres:postgres@localhost:5432/rag

# Connection pool settings (optional)
# DB_POOL_SIZE=5
# DB_MAX_OVERFLOW=10
# DB_POOL_TIMEOUT=30

# Use real Postgres implementation (True) or placeholder memory implementation (False)
USE_REAL_DB=false

# =============================================================================
# Redis (Cache + Celery Broker) / ريديس
# =============================================================================
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2

# Embedding cache TTL in seconds (default: 7 days)
EMBEDDING_CACHE_TTL=604800

# =============================================================================
# Vector Store (Qdrant) / مخزن المتجهات
# =============================================================================
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_COLLECTION=chunks

# For Qdrant Cloud (optional)
# QDRANT_API_KEY=your-qdrant-api-key
# QDRANT_URL=https://your-cluster.qdrant.io

# =============================================================================
# Embeddings / التضمينات
# =============================================================================
EMBEDDINGS_BACKEND=openai                  # openai | local | gemini | huggingface
EMBEDDING_DIM=1536                         # Must match the model output dimension

# OpenAI Embeddings
OPENAI_EMBED_MODEL=text-embedding-3-small  # text-embedding-3-small | text-embedding-3-large

# Local Embeddings (SentenceTransformers)
# LOCAL_EMBED_MODEL=all-MiniLM-L6-v2
# LOCAL_EMBED_DEVICE=cpu                   # cpu | cuda

# Hugging Face Embeddings (via Inference API)
HF_EMBED_MODEL=sentence-transformers/all-MiniLM-L6-v2

# =============================================================================
# LLM Provider / مزود نموذج اللغة
# =============================================================================
LLM_BACKEND=openai                         # openai | ollama | gemini | huggingface

# OpenAI Configuration
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_CHAT_MODEL=gpt-4o-mini              # gpt-4o-mini | gpt-4o | gpt-4-turbo
OPENAI_MAX_TOKENS=700
OPENAI_TEMPERATURE=0.2

# Ollama Configuration (for local LLM)
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_CHAT_MODEL=llama3.1
OLLAMA_EMBED_MODEL=nomic-embed-text

# Gemini Configuration
GEMINI_API_KEY=AIza...
GEMINI_CHAT_MODEL=gemini-1.5-flash
GEMINI_EMBED_MODEL=models/embedding-001

# Hugging Face Configuration
HF_API_KEY=hf_...
HF_CHAT_MODEL=mistralai/Mistral-7B-Instruct-v0.2
HF_USE_INFERENCE_API=true                  # Set to false to load model locally (requires heavy RAM)

# =============================================================================
# Reranking / إعادة الترتيب
# =============================================================================
RERANK_BACKEND=cross_encoder               # cross_encoder | llm | none

# Cross-Encoder Configuration
CROSS_ENCODER_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2
CROSS_ENCODER_DEVICE=cpu                   # cpu | cuda

# Reranking Parameters
RERANK_TOP_N=8                             # Number of top results after reranking

# =============================================================================
# Retrieval Settings / إعدادات الاسترجاع
# =============================================================================
# Default retrieval parameters (can be overridden per request)
DEFAULT_K_VECTOR=30                        # Top-K for vector search
DEFAULT_K_KEYWORD=30                       # Top-K for keyword search
DEFAULT_FUSED_LIMIT=40                     # Max results after RRF fusion

# RRF Fusion constant
RRF_K=60                                   # RRF constant (default: 60)

# =============================================================================
# Chunking Settings / إعدادات التقطيع
# =============================================================================
CHUNK_MAX_TOKENS=512                       # Maximum tokens per chunk
CHUNK_OVERLAP_TOKENS=50                    # Overlap between chunks
CHUNK_ENCODING=cl100k_base                 # tiktoken encoding name

# =============================================================================
# File Upload / رفع الملفات
# =============================================================================
UPLOAD_DIR=./uploads
MAX_UPLOAD_MB=20

# Allowed file extensions (comma-separated)
ALLOWED_EXTENSIONS=pdf,docx,txt

# =============================================================================
# Workers (Celery) / العمال
# =============================================================================
CELERY_WORKER_CONCURRENCY=4
CELERY_TASK_TIME_LIMIT=600                 # 10 minutes max per task
CELERY_TASK_SOFT_TIME_LIMIT=540            # Soft limit for cleanup

# =============================================================================
# Observability / المراقبة
# =============================================================================
# Enable metrics endpoint
ENABLE_METRICS=true
METRICS_PATH=/metrics

# Request ID header
REQUEST_ID_HEADER=X-Request-ID

# =============================================================================
# Development Settings / إعدادات التطوير
# =============================================================================
# Hot reload for development
RELOAD=true

# CORS (comma-separated origins, or * for all)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# =============================================================================
# Multi-Tool / Agentic Features / مميزات الوكيل الذكي
# =============================================================================
TAVILY_API_KEY=tvly-...                   # Required for Web Search fallback
AGENT_MAX_ITERATIONS=5
AGENT_VERBOSE=true
